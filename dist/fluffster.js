function State(t,e){return this instanceof State?(e=e||{},this._id=[],this.state=utils.extendMany({},e,t.appState),t.component&&(this._component=t.component),t.id&&(this._id=t.id),t.messages&&this.assignMessages(t.messages),this.onNext=function(t){t&&this._id.indexOf(t)===-1&&this._id.push(t),this._component&&this.provide(this.state)}.bind(this),this.updateState=function(t){var e=utils.extendMany({},this.state,t);utils.compareTo(this.state,e)||(utils.extend(this.state,t),this.onNext())}.bind(this),this.onNext(),void 0):new State(t,e)}var utils=require("./utils");renderLoop=utils.renderLoop,State.prototype.provide=function(t){this.renderLoop||(this.renderLoop=renderLoop(this._component)),this.renderLoop(t)},State.prototype.passMessage=function(t,e){t in this.messages&&this.updateState(this.messages[t](this.state,e))},State.prototype.assignMessages=function(t){this.messages=t},State.prototype.of=function(t){return this._component=[t],this._id.length?void this.onNext():{render:this.onNext.bind(this),component:t}},module.exports=State;