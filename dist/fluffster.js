function State(t,e,s){return this instanceof State?(this.state=t.appState,this._streamA$=kefir.pool(),this._streamB$=s,this.component=t.component,this._combined$=!(!this._streamA$||!this._streamB$)&&kefir.combine([this._streamA$,this._streamB$],function(t,e){return utils.extendMany({},t,e)}),this.listeners=[],e&&this.assignMessages(e),this.onNext(function(t){this._streamA$.plug(kefir.stream(function(e){return e.emit(t)}))}.bind(this)),this.updateState=function(t){var e=utils.extendMany({},this.state,t);utils.compareTo(this.state,e)||(utils.extend(this.state,t),this.notify())}.bind(this),this.notify(),this.provide(),void 0):new State(t)}var utils=require("./utils"),kefir=require("kefir");State.prototype.notify=function(t){t=t||this.state;for(var e=0;e<this.listeners.length;e++)this.listeners[e](t)},State.prototype.onNext=function(t){this.listeners.push(t)},State.prototype.stream=function(){return this._combined$?this._combined$:this._streamA$},State.prototype.combine=function(t){this._streamA$.plug(kefir.combine([this.stream(),t],function(t,e){return utils.extendMany({},t,e)}))},State.prototype.provide=function(){this.stream().onValue(function(t){utils.each(this.component,function(e){e.subscribe&&e.subscribe(t)}.bind(this))}.bind(this))},State.prototype.passMessage=function(t,e){t in this.messages&&this.updateState(this.messages[t](this.state,e))},State.prototype.assignMessages=function(t){this.messages=t},module.exports=State;